---

- name: Tareas Comunes 
  hosts: all
  become: true  
  gather_facts: false

  tasks:
    - name: Instalamos kubernetes
      command: dnf install -y kubelet kubeadm kubectl --disableexcludes=kubernetes
    - name: Activamos kubernetes
      command: systemctl enable kubelet
    - name: Iniciamos kubernetes
      command: systemctl start kubelet   
    - name: Configuramos kubeadm
      command: kubeadm config images pull
      
    - name: Permitimos el acceso al worker
      command: firewall-cmd --permanent --add-rich-rule 'rule family=ipv4 source address=10.0.1.12/32 accept'
    - name: Recargamos el firewall
      command: firewall-cmd --reload
      
    - name: Permitimos el acceso de los contenedores
      command: firewall-cmd --zone=public --permanent --add-rich-rule 'rule family=ipv4 source address=172.17.0.1/16 accept'
    - name: Recargamos el firewall
      command: firewall-cmd --reload
      
    - name: Instalamos el pluguin CNI
      command:  kubeadm init --pod-network-cidr 192.169.0.0/16 --ignore-preflight-errors all
      
      
